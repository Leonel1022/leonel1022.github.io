<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>V</title>
    <style>
        :root {
            --bg-color: #000000;
            --card-color: #1c1c1e;
            --accent-color: #0a84ff;
            --text-color: #ffffff;
            --subtext-color: #8e8e93;
            --shadow-color: rgba(0,0,0,0.7);
        }

        body {
            font-family: -apple-system, system-ui, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding-bottom: 60px;
            overflow-y: auto;
            -webkit-font-smoothing: antialiased;
        }

        .controls-container {
            width: 100%;
            background: linear-gradient(to bottom, var(--card-color), #141416);
            padding: 25px 0;
            border-bottom: 1px solid #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .scroll-area {
            width: 90%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .label-row {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            text-transform: uppercase;
            color: var(--subtext-color);
            letter-spacing: 0.6px;
        }

        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 30px;
            background: transparent;
            outline: none;
            margin: 0;
            touch-action: none;
        }

        input[type="range"]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            background: #3a3a3c;
            border-radius: 3px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 26px;
            width: 26px;
            border-radius: 50%;
            background: var(--accent-color);
            margin-top: -10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
            transition: transform 0.1s ease;
        }

        input[type="range"]:active::-webkit-slider-thumb {
            transform: scale(1.1);
        }

        .preview-area {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 40px 0;
            flex-grow: 1;
        }

        #export-container {
            position: relative;
            width: 90vw;
            height: 90vw;
            max-width: 420px;
            max-height: 420px;
            overflow: hidden;
            border-radius: 20px;
            background: #111;
            box-shadow: 0 12px 40px rgba(0,0,0,0.6);
            transition: box-shadow 0.3s ease;
        }

        #bg-layer {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: blur(30px) brightness(0.6);
            transform: scale(1.3);
            z-index: 1;
            transition: filter 0.2s ease, transform 0.2s ease;
        }

        #fg-layer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
            box-shadow: 0 10px 40px var(--shadow-color);
            max-width: 75%;
            pointer-events: none;
            transition: max-width 0.2s ease, border-radius 0.2s ease;
        }

        .btn-main {
            background: linear-gradient(to bottom, var(--accent-color), #007aff);
            color: white;
            border: none;
            width: 100%;
            padding: 16px;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            margin-top: 15px;
            -webkit-tap-highlight-color: transparent;
            box-shadow: 0 4px 12px rgba(10,132,255,0.3);
            transition: transform 0.1s ease, box-shadow 0.1s ease;
        }

        .btn-main:active {
            transform: scale(0.98);
            box-shadow: 0 2px 6px rgba(10,132,255,0.2);
        }

        #canvas-hidden { display: none; }
        
        input[type="file"] {
            margin-bottom: 15px;
            color: var(--subtext-color);
            width: 100%;
            text-align: center;
        }

        .header-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-color);
        }
    </style>
</head>
<body>

    <div class="controls-container">
        <div class="scroll-area">
            <div class="header-title">Marco de Foto V</div>
            <input type="file" id="upload" accept="image/*">

            <div class="control-group">
                <div class="label-row"><span>Grosor Marco</span><span id="v-frame">75%</span></div>
                <input type="range" id="frameWidth" min="30" max="95" value="75">
            </div>

            <div class="control-group">
                <div class="label-row"><span>Desenfoque</span><span id="v-blur">30px</span></div>
                <input type="range" id="blurRange" min="0" max="80" value="30">
            </div>

            <div class="control-group">
                <div class="label-row"><span>Zoom Fondo</span><span id="v-zoom">1.3x</span></div>
                <input type="range" id="bgScale" min="1" max="2" step="0.01" value="1.3">
            </div>

            <div class="control-group">
                <div class="label-row"><span>Bordes Redondeados</span><span id="v-radius">0px</span></div>
                <input type="range" id="borderRadius" min="0" max="50" value="0">
            </div>

            <button class="btn-main" id="downloadBtn">Guardar</button>
        </div>
    </div>

    <div class="preview-area">
        <div id="export-container">
            <img id="bg-layer" src="" style="display:none;">
            <img id="fg-layer" src="" style="display:none;">
        </div>
    </div>

    <canvas id="canvas-hidden"></canvas>

    <script>
        const uploadInput = document.getElementById('upload');
        const bgImage = document.getElementById('bg-layer');
        const fgImage = document.getElementById('fg-layer');
        
        const frameSlider = document.getElementById('frameWidth');
        const blurSlider = document.getElementById('blurRange');
        const zoomSlider = document.getElementById('bgScale');
        const radiusSlider = document.getElementById('borderRadius');

        const frameValue = document.getElementById('v-frame');
        const blurValue = document.getElementById('v-blur');
        const zoomValue = document.getElementById('v-zoom');
        const radiusValue = document.getElementById('v-radius');

        uploadInput.onchange = (event) => {
            const selectedFile = event.target.files[0];
            if (selectedFile) {
                const imageUrl = URL.createObjectURL(selectedFile);
                bgImage.src = imageUrl;
                fgImage.src = imageUrl;
                bgImage.style.display = 'block';
                fgImage.style.display = 'block';
            }
        };

        frameSlider.oninput = () => {
            fgImage.style.maxWidth = `${frameSlider.value}%`;
            frameValue.innerText = `${frameSlider.value}%`;
        };

        blurSlider.oninput = () => {
            bgImage.style.filter = `blur(${blurSlider.value}px) brightness(0.6)`;
            blurValue.innerText = `${blurSlider.value}px`;
        };

        zoomSlider.oninput = () => {
            bgImage.style.transform = `scale(${zoomSlider.value})`;
            zoomValue.innerText = `${zoomSlider.value}x`;
        };

        radiusSlider.oninput = () => {
            fgImage.style.borderRadius = `${radiusSlider.value}px`;
            radiusValue.innerText = `${radiusSlider.value}px`;
        };

        document.getElementById('downloadBtn').onclick = () => {
            const hiddenCanvas = document.getElementById('canvas-hidden');
            const canvasCtx = hiddenCanvas.getContext('2d');
            hiddenCanvas.width = 1200;
            hiddenCanvas.height = 1200;

            
            canvasCtx.filter = `blur(${blurSlider.value * 3}px) brightness(0.6)`;
            const scaleFactor = zoomSlider.value;
            canvasCtx.drawImage(bgImage, (1200 - 1200 * scaleFactor) / 2, (1200 - 1200 * scaleFactor) / 2, 1200 * scaleFactor, 1200 * scaleFactor);

            
            canvasCtx.filter = 'none';

            const sizePercent = frameSlider.value / 100;
            const imageRatio = fgImage.naturalWidth / fgImage.naturalHeight;
            let drawWidth = 1200 * sizePercent;
            let drawHeight = drawWidth / imageRatio;
            
            if (drawHeight > 1200 * sizePercent) {
                drawHeight = 1200 * sizePercent;
                drawWidth = drawHeight * imageRatio;
            }

            const drawX = (1200 - drawWidth) / 2;
            const drawY = (1200 - drawHeight) / 2;
            const cornerRadius = radiusSlider.value * 3; 

            
            canvasCtx.shadowColor = "rgba(0,0,0,0.8)";
            canvasCtx.shadowBlur = 60;
            canvasCtx.fillStyle = 'transparent';
            canvasCtx.beginPath();
            canvasCtx.moveTo(drawX + cornerRadius, drawY);
            canvasCtx.lineTo(drawX + drawWidth - cornerRadius, drawY);
            canvasCtx.quadraticCurveTo(drawX + drawWidth, drawY, drawX + drawWidth, drawY + cornerRadius);
            canvasCtx.lineTo(drawX + drawWidth, drawY + drawHeight - cornerRadius);
            canvasCtx.quadraticCurveTo(drawX + drawWidth, drawY + drawHeight, drawX + drawWidth - cornerRadius, drawY + drawHeight);
            canvasCtx.lineTo(drawX + cornerRadius, drawY + drawHeight);
            canvasCtx.quadraticCurveTo(drawX, drawY + drawHeight, drawX, drawY + drawHeight - cornerRadius);
            canvasCtx.lineTo(drawX, drawY + cornerRadius);
            canvasCtx.quadraticCurveTo(drawX, drawY, drawX + cornerRadius, drawY);
            canvasCtx.closePath();
            canvasCtx.fill(); 

            
            canvasCtx.shadowColor = 'transparent';
            canvasCtx.shadowBlur = 0;

            
            canvasCtx.save();
            canvasCtx.beginPath();
            canvasCtx.moveTo(drawX + cornerRadius, drawY);
            canvasCtx.lineTo(drawX + drawWidth - cornerRadius, drawY);
            canvasCtx.quadraticCurveTo(drawX + drawWidth, drawY, drawX + drawWidth, drawY + cornerRadius);
            canvasCtx.lineTo(drawX + drawWidth, drawY + drawHeight - cornerRadius);
            canvasCtx.quadraticCurveTo(drawX + drawWidth, drawY + drawHeight, drawX + drawWidth - cornerRadius, drawY + drawHeight);
            canvasCtx.lineTo(drawX + cornerRadius, drawY + drawHeight);
            canvasCtx.quadraticCurveTo(drawX, drawY + drawHeight, drawX, drawY + drawHeight - cornerRadius);
            canvasCtx.lineTo(drawX, drawY + cornerRadius);
            canvasCtx.quadraticCurveTo(drawX, drawY, drawX + cornerRadius, drawY);
            canvasCtx.closePath();
            canvasCtx.clip();

            canvasCtx.drawImage(fgImage, drawX, drawY, drawWidth, drawHeight);
            canvasCtx.restore();

            
            const downloadLink = document.createElement('a');
            downloadLink.download = 'marco_foto.png';
            downloadLink.href = hiddenCanvas.toDataURL('image/png', 1.0);
            downloadLink.click();
        };
    </script>
</body>
</html>
