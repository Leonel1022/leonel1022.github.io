<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, follow">
    <meta name="author" content="Leonel1022">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Impostor Anotador</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --accent-color: #bb86fc;
            --danger-color: #cf6679;
            --success-color: #03dac6;
            --font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-family);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 420px;
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            text-align: center;
            transition: height 0.3s;
        }

        h1, h2 { margin-bottom: 20px; font-weight: 300; letter-spacing: 1px; }
        h1 { color: var(--accent-color); }

        /* Formularios y Botones */
        .input-group { margin-bottom: 15px; text-align: left; }
        label { display: block; margin-bottom: 5px; font-size: 0.9rem; color: #aaa; }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            background: #2c2c2c;
            border: 1px solid #333;
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            outline: none;
            resize: none; 
        }

        input:focus, select:focus, textarea:focus { border-color: var(--accent-color); }

        button {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
            margin-top: 10px;
        }

        .btn-primary { background-color: var(--accent-color); color: #000; }
        .btn-secondary { background-color: #333; color: white; margin-top: 5px;}
        .btn-danger { background-color: var(--danger-color); color: #000; }
        .btn-small { width: auto; padding: 8px 15px; font-size: 0.9rem; margin-top: 0; margin-left: 5px;}

        button:active { opacity: 0.8; }

        /* Chips de Categor√≠as */
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            background: #252525;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #333;
        }
        .cat-tag {
            background: #333;
            color: #888;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.2s;
            user-select: none;
        }
        .cat-tag.active {
            background: var(--accent-color);
            color: #000;
            font-weight: bold;
            box-shadow: 0 0 5px rgba(187, 134, 252, 0.4);
        }

        /* Lista de Jugadores */
        #player-list-display {
            list-style: none;
            text-align: left;
            margin-bottom: 15px;
            max-height: 120px;
            overflow-y: auto;
        }
        #player-list-display li {
            background: #252525;
            padding: 8px 12px;
            margin-bottom: 5px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .remove-player { color: var(--danger-color); cursor: pointer; font-weight: bold; }

        /* Pantallas */
        .screen { display: none; animation: fadeIn 0.3s ease; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .hidden { display: none; }

        /* Mec√°nica de Revelar */
        .reveal-card {
            background: #252525;
            padding: 30px;
            border-radius: 12px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #333;
        }

        .secret-content { font-size: 1.5rem; font-weight: bold; color: var(--success-color); }
        .impostor-text { color: var(--danger-color); }

        .cover-slider {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #333;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: transform 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
            z-index: 10; cursor: pointer;
        }
        .cover-slider p { margin-top: 10px; font-size: 0.9rem; color: #ccc; pointer-events: none;}
        .lock-icon { width: 24px; height: 18px; border: 2px solid #ccc; border-radius: 4px; position: relative; }
        .lock-icon:before { content: ''; position: absolute; left: 5px; top: -10px; width: 10px; height: 10px; border: 2px solid #ccc; border-bottom: none; border-radius: 10px 10px 0 0; }
        
        .revealed .cover-slider { transform: translateY(100%); }

        /* Votaci√≥n y Resultados */
        .vote-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;}
        .vote-btn { background: #252525; padding: 15px; border-radius: 8px; color: white; border: 1px solid #333; font-size: 1rem;}
        .ejection-result-box { padding: 20px; border-radius: 10px; background: #222; border: 1px solid #444; margin: 20px 0; }
        .ejection-role { font-size: 1.8rem; font-weight: bold; margin-top: 10px; display: block; }
        .result-item { background: #252525; margin-bottom: 10px; padding: 10px; border-radius: 8px; text-align: left; }
        .role-highlight { float: right; font-weight: bold; }
        .is-impostor { color: var(--danger-color); }
        .is-civilian { color: var(--success-color); }
        .is-dead { text-decoration: line-through; opacity: 0.5; }

    </style>
</head>
<body>

<div class="container">

    <div id="screen-setup" class="screen active">
        <h1>IMPOSTOR</h1>
        
        <div class="input-group">
            <label>Agregar Jugador</label>
            <div style="display: flex;">
                <input type="text" id="player-name-input" placeholder="Nombre..." onkeypress="handleEnter(event)">
                <button class="btn-primary btn-small" onclick="addPlayer()">+</button>
            </div>
        </div>
        <ul id="player-list-display"></ul>

        <div class="input-group">
            <label>Categor√≠a</label>
            <select id="category-select" onchange="handleSetupChange()">
                </select>
        </div>

        <div id="category-filter-area" class="input-group hidden">
            <label>Toca para activar/desactivar:</label>
            <div class="tags-container" id="tags-container">
                </div>
            <p style="font-size: 0.7rem; color:#666; margin-top:5px;">Se elegir√° una categor√≠a al azar de las marcadas.</p>
        </div>

        <div id="custom-area" class="input-group hidden">
            <label>Tus palabras (separadas por coma):</label>
            <textarea id="custom-words-input" rows="3" placeholder="Ej: Pizza, Hamburguesa, Sushi..."></textarea>
            <p style="font-size: 0.7rem; color:#666; margin-top:5px;">*Si usas la opci√≥n "Con Pistas", solo ver√°s la categor√≠a.</p>
        </div>
        
        <div class="input-group">
            <label>Modo de Pistas</label>
            <select id="hint-mode-select">
                <option value="enabled">üí° Con Pistas (Ayuda al impostor)</option>
                <option value="disabled">üö´ Sin Pistas (Solo la Categor√≠a)</option>
            </select>
        </div>

        <div class="input-group">
            <label>Cantidad de Impostores</label>
            <select id="impostor-count-select" onchange="handleSetupChange()">
                <option value="1">1 Impostor</option>
                <option value="2">2 Impostores</option>
                <option value="3">3 Impostores</option>
                <option value="custom">‚úçÔ∏è Personalizado</option>
                <option value="random">‚ùì Aleatorio (1 a N-1)</option>
            </select>
        </div>

        <div id="impostor-custom-input-group" class="input-group hidden">
            <input type="number" id="custom-impostor-count" placeholder="Escribe el n√∫mero exacto" min="1" value="4">
        </div>

        <button class="btn-primary" onclick="startGame()">Comenzar Partida</button>
    </div>

    <div id="screen-reveal" class="screen">
        <h2 id="turn-player-name">Turno de [Nombre]</h2>
        <p style="font-size: 0.9rem; opacity: 0.7;">Pasa el dispositivo a este jugador.</p>

        <div id="card-container" class="reveal-card" onclick="toggleSecret()">
            <div class="cover-slider">
                <div class="lock-icon"></div>
                <p>Mant√©n presionado o toca</p>
            </div>
            <div class="secret-content" id="secret-text"></div>
        </div>
        <p style="font-size: 0.8rem; color: #888; margin-bottom: 20px;">Memoriza y oculta r√°pido.</p>
        <button class="btn-primary" id="next-player-btn" onclick="nextPlayer()" disabled>Siguiente Jugador</button>
    </div>

    <div id="screen-game" class="screen">
        <h2>¬°A Jugar!</h2>
        <p style="margin-bottom: 30px; line-height: 1.5; color: #ccc;">
            Debatan, pregunten y descubran qui√©n miente.<br>
            <span style="font-size: 0.8rem; color:#666;">(Categor√≠a oculta)</span>
        </p>
        <button class="btn-primary" onclick="goToVoting()">Votar / Expulsar</button>
        <button class="btn-danger" onclick="endGame()">Rendirse / Ver Todo</button>
    </div>

    <div id="screen-voting" class="screen">
        <h2>Sala de Votaci√≥n</h2>
        <p>¬øQui√©n es sospechoso?</p>
        <div id="voting-grid" class="vote-grid"></div>
        <button class="btn-secondary" onclick="switchScreen('screen-game')">Cancelar</button>
    </div>

    <div id="screen-ejection" class="screen">
        <h2>Resultado</h2>
        <div class="ejection-result-box">
            <span id="ejected-name" style="font-size: 1.2rem; color: #aaa;"></span>
            <br>era...
            <span id="ejected-role" class="ejection-role"></span>
        </div>
        <button class="btn-primary" onclick="continueGame()">Seguir Jugando</button>
        <button class="btn-danger" onclick="endGame()">Terminar Partida</button>
    </div>

    <div id="screen-results" class="screen">
        <h2>Partida Finalizada</h2>
        <p>La palabra era: <strong id="reveal-word" style="color: var(--success-color)"></strong></p>
        <div id="results-list"></div>
        <button class="btn-primary" onclick="resetGame()">Configurar Nueva Partida</button>
    </div>

</div>

<script>
    // --- DATOS (NUEVA ESTRUCTURA CON PALABRA Y 3 PISTAS) ---
    // Cada elemento es un objeto { word: "Palabra", hints: ["PistaF√°cil", "PistaMedia", "PistaDif√≠cil"] }
    const database = {
        "Deportes": [
            { word: "F√∫tbol", hints: ["Pelota", "Gol", "Messi"] },
            { word: "Tenis", hints: ["Raqueta", "Wimbledon", "Deuce"] },
            { word: "Nataci√≥n", hints: ["Piscina", "Estilos", "Delf√≠n"] },
            { word: "Baloncesto", hints: ["Cesta", "Driblar", "NBA"] },
            { word: "Voleibol", hints: ["Red", "Saque", "Bloqueo"] },
            { word: "Rugby", hints: ["Ovalada", "M√™l√©e", "Haka"] },
            { word: "Golf", hints: ["Putter", "Hoyos", "Caddy"] },
            { word: "Boxeo", hints: ["Guantes", "Ring", "Knockout"] },
            { word: "Surf", hints: ["Ola", "Tabla", "Tubo"] },
            { word: "Atletismo", hints: ["Pista", "Carrera", "Decatl√≥n"] },
            { word: "Ciclismo", hints: ["Bicicleta", "Tour", "Monta√±a"] },
            { word: "Hockey", hints: ["Disco", "Stick", "Hielo"] },
            { word: "Esgrima", hints: ["Espada", "Florete", "Tocados"] },
            { word: "Gimnasia", hints: ["Aro", "Cinta", "Asim√©tricas"] },
            { word: "Polo Acu√°tico", hints: ["Piscina", "Gorro", "Boyas"] },
            { word: "B√©isbol", hints: ["Bate", "Home Run", "Pitcher"] },
            { word: "Judo", hints: ["Tatami", "Cintur√≥n", "Ippon"] }
        ],
        "Cocina": [
            { word: "Tenedor", hints: ["Pinchar", "Cubierto", "Tres puntas"] },
            { word: "Sart√©n", hints: ["Caliente", "Aceite", "Tortilla"] },
            { word: "Licuadora", hints: ["Fruta", "Batido", "Giro"] },
            { word: "Microondas", hints: ["Tiempo", "Calentar", "Radiaci√≥n"] },
            { word: "Cuchillo", hints: ["Cortar", "Filo", "Chef"] },
            { word: "Olla", hints: ["Sopa", "Vapor", "Presi√≥n"] },
            { word: "Cafetera", hints: ["Grano", "Desayuno", "Aroma"] },
            { word: "Tostadora", hints: ["Pan", "El√©ctrico", "Salida"] },
            { word: "Rallador", hints: ["Queso", "Zanahoria", "Frotar"] },
            { word: "Batidora", hints: ["Mezclar", "Reposter√≠a", "Globo"] },
            { word: "Tabla de cortar", hints: ["Madera", "Picar", "Higiene"] },
            { word: "Cuchara", hints: ["Sopa", "Postre", "Grande"] },
            { word: "Colador", hints: ["Pasta", "L√≠quido", "Red"] },
            { word: "Servilleta", hints: ["Boca", "Tela", "Desechable"] },
            { word: "Vasos", hints: ["Beber", "Cristal", "Llenar"] }
        ],
        "Pel√≠culas": [
            { word: "Titanic", hints: ["Hielo", "Barco", "DiCaprio"] },
            { word: "El Padrino", hints: ["Mafia", "Italia", "Corleone"] },
            { word: "Harry Potter", hints: ["Magia", "Varita", "Hogwarts"] },
            { word: "Star Wars", hints: ["Espada", "Fuerza", "Galaxia"] },
            { word: "Avatar", hints: ["Azul", "3D", "Pandora"] },
            { word: "Jurassic Park", hints: ["Dinosaurios", "Isla", "Mosquito"] },
            { word: "El Rey Le√≥n", hints: ["Sabana", "C√≠rculo", "Mufasa"] },
            { word: "Matrix", hints: ["P√≠ldora", "Elegido", "Neo"] },
            { word: "Avengers", hints: ["H√©roes", "Gemas", "Marvel"] },
            { word: "Terminator", hints: ["Cyborg", "Futuro", "Skynet"] },
            { word: "Piratas del Caribe", hints: ["Barco", "Ron", "Jack Sparrow"] },
            { word: "Pulp Fiction", hints: ["Tarantino", "Malet√≠n", "Baile"] },
            { word: "Forrest Gump", hints: ["Correr", "Pluma", "Chocolate"] },
            { word: "Par√°sitos", hints: ["Clase", "Coreana", "Bunker"] },
            { word: "Gladiador", hints: ["Roma", "Coliseo", "Venganza"] }
        ],
        "Series": [
            { word: "Breaking Bad", hints: ["Qu√≠mica", "Profesor", "Azul"] },
            { word: "Game of Thrones", hints: ["Dragones", "Invierno", "Trono"] },
            { word: "Friends", hints: ["Caf√©", "Nueva York", "Seis"] },
            { word: "Stranger Things", hints: ["80s", "Monstruo", "Once"] },
            { word: "Los Simpson", hints: ["Amarillo", "Springfield", "Cerveza"] },
            { word: "La Casa de Papel", hints: ["M√°scara", "Atraco", "Profesor"] },
            { word: "The Office", hints: ["Jefe", "Documental", "Papelera"] },
            { word: "Vikingos", hints: ["N√≥rdicos", "Barco", "Ragnar"] },
            { word: "Peaky Blinders", hints: ["Sombrero", "Inglaterra", "G√°ngster"] },
            { word: "Euphoria", hints: ["Adolescencia", "Brillos", "Zendaya"] },
            { word: "Seinfeld", hints: ["Nada", "Stand-up", "Jerry"] },
            { word: "Merlina", hints: ["Negro", "Academia", "Mano"] },
            { word: "Squid Game", hints: ["Juegos", "N√∫mero", "Corea"] }
        ],
        "Materias": [
            { word: "Matem√°ticas", hints: ["N√∫meros", "C√°lculo", "Ecuaci√≥n"] },
            { word: "Historia", hints: ["Pasado", "Fechas", "Guerras"] },
            { word: "Geograf√≠a", hints: ["Mapa", "R√≠os", "Capitales"] },
            { word: "Biolog√≠a", hints: ["Vida", "C√©lula", "ADN"] },
            { word: "Qu√≠mica", hints: ["Tabla", "Elemento", "Mol√©cula"] },
            { word: "F√≠sica", hints: ["Movimiento", "Fuerza", "Gravedad"] },
            { word: "Arte", hints: ["Pincel", "Color", "Creatividad"] },
            { word: "Literatura", hints: ["Libro", "Novela", "Verso"] },
            { word: "Ingl√©s", hints: ["Idioma", "Global", "Shakespeare"] },
            { word: "Filosof√≠a", hints: ["Pensar", "Sabidur√≠a", "S√≥crates"] },
            { word: "Econom√≠a", hints: ["Dinero", "Mercado", "Oferta"] },
            { word: "Inform√°tica", hints: ["Computadora", "C√≥digo", "Algoritmo"] },
            { word: "Educaci√≥n C√≠vica", hints: ["Leyes", "Derechos", "Voto"] },
            { word: "Deportes", hints: ["Ejercicio", "Reglas", "Equipo"] }
        ],
        "Animales": [
            { word: "Le√≥n", hints: ["Rey", "Melena", "Sabana"] },
            { word: "Elefante", hints: ["Trompa", "Gris", "Memoria"] },
            { word: "Perro", hints: ["Mascota", "Ladra", "Fiel"] },
            { word: "Gato", hints: ["Bigotes", "Maullar", "Independiente"] },
            { word: "√Åguila", hints: ["Volar", "Rapaz", "Nido"] },
            { word: "Tibur√≥n", hints: ["Oc√©ano", "Aleta", "Blanco"] },
            { word: "Serpiente", hints: ["Rastrea", "Venenosa", "Siseo"] },
            { word: "Ping√ºino", hints: ["Fr√≠o", "Ant√°rtida", "Traje"] },
            { word: "Jirafa", hints: ["Cuello", "Alto", "Manchas"] },
            { word: "Oso", hints: ["Hiberna", "Miel", "Pardo"] },
            { word: "Delf√≠n", hints: ["Inteligente", "Sonar", "Mam√≠fero"] },
            { word: "Caballo", hints: ["Crines", "Montar", "Herradura"] },
            { word: "Cebra", hints: ["Rayas", "√Åfrica", "Equino"] },
            { word: "Rinoceronte", hints: ["Cuerno", "Grueso", "Pachidermo"] },
            { word: "Pez Payaso", hints: ["Nemo", "An√©mona", "Rayas"] },
            { word: "Murci√©lago", hints: ["Noche", "Cueva", "Vuela"] }
        ],
        "Frutas": [
            { word: "Manzana", hints: ["Rojo", "Muerde", "Newton"] },
            { word: "Banana", hints: ["Amarillo", "Mono", "Curva"] },
            { word: "Frutilla", hints: ["Roja", "Semillas", "Postre"] },
            { word: "Uva", hints: ["Racimo", "Vino", "Pasa"] },
            { word: "Sand√≠a", hints: ["Verde", "Verano", "Agua"] },
            { word: "Naranja", hints: ["Jugo", "Vitamina C", "√Åcido"] },
            { word: "Pi√±a", hints: ["Tropical", "Corona", "Rugosa"] },
            { word: "Lim√≥n", hints: ["Agrura", "Rodaja", "C√≠trico"] },
            { word: "Cereza", hints: ["Peque√±a", "Rojo", "Par"] },
            { word: "Pera", hints: ["Forma", "Jugo", "Verde"] },
            { word: "Mango", hints: ["Tropical", "Dulce", "Carozo"] },
            { word: "Kiwi", hints: ["Pelos", "Verde", "Zespri"] },
            { word: "Durazno", hints: ["Pelusa", "Verano", "Rosado"] },
            { word: "Palta", hints: ["Verde", "Grasa", "Guacamole"] },
            { word: "Mel√≥n", hints: ["Esfera", "Dulce", "Amarillo"] }
        ],
        "Pa√≠ses": [
            { word: "Espa√±a", hints: ["Paella", "Toro", "Flamenco"] },
            { word: "Argentina", hints: ["Asado", "Mate", "Tango"] },
            { word: "M√©xico", hints: ["Taco", "Tequila", "Aztecas"] },
            { word: "Jap√≥n", hints: ["Sushi", "Anime", "Tokio"] },
            { word: "Francia", hints: ["Torre", "Vino", "Par√≠s"] },
            { word: "Italia", hints: ["Pizza", "Bota", "Coliseo"] },
            { word: "Brasil", hints: ["Samba", "R√≠o", "Selva"] },
            { word: "EEUU", hints: ["Estrellas", "D√≥lar", "Estatua"] },
            { word: "Alemania", hints: ["Cerveza", "Muro", "Motor"] },
            { word: "Canad√°", hints: ["Arce", "Fr√≠o", "Nieve"] },
            { word: "China", hints: ["Muralla", "Panda", "Arroz"] },
            { word: "India", hints: ["Curry", "Taj Mahal", "Bollywood"] },
            { word: "Egipto", hints: ["Pir√°mides", "Nilo", "Fara√≥n"] },
            { word: "Rusia", hints: ["Fr√≠o", "Kremlin", "Vodka"] },
            { word: "Australia", hints: ["Canguro", "S√≠dney", "Koala"] }
        ],
        "Superh√©roes": [
            { word: "Batman", hints: ["Murci√©lago", "G√≥tica", "Mayordomo"] },
            { word: "Superman", hints: ["Kriptonita", "Capa", "Clark"] },
            { word: "Spiderman", hints: ["Telara√±a", "Vecindario", "Peter"] },
            { word: "Wonder Woman", hints: ["Amazona", "Lazo", "Diana"] },
            { word: "Iron Man", hints: ["Genio", "Armadura", "Tony"] },
            { word: "Thor", hints: ["Martillo", "Asgard", "Trueno"] },
            { word: "Hulk", hints: ["Verde", "Rabia", "Banner"] },
            { word: "Flash", hints: ["R√°pido", "Rayo", "Velocidad"] },
            { word: "Aquaman", hints: ["Mar", "Tridente", "Atl√°ntida"] },
            { word: "Capit√°n Am√©rica", hints: ["Escudo", "Suero", "Steve"] },
            { word: "Black Widow", hints: ["Esp√≠a", "Rusia", "Natasha"] },
            { word: "Doctor Strange", hints: ["Portal", "Tiempo", "Capa"] },
            { word: "Linterna Verde", hints: ["Anillo", "Voluntad", "Sector"] }
        ],
        "Profesiones": [
            { word: "M√©dico", hints: ["Hospital", "Estetoscopio", "Salud"] },
            { word: "Bombero", hints: ["Fuego", "Manguera", "Rescate"] },
            { word: "Polic√≠a", hints: ["Ley", "Placa", "Patrulla"] },
            { word: "Maestro", hints: ["Clase", "Pizarra", "Estudiantes"] },
            { word: "Ingeniero", hints: ["Dise√±o", "Construcci√≥n", "C√°lculo"] },
            { word: "Abogado", hints: ["Corte", "Ley", "Defender"] },
            { word: "Cocinero", hints: ["Restaurante", "Recetas", "Sabor"] },
            { word: "Astronauta", hints: ["Espacio", "Cohete", "Gravedad"] },
            { word: "Arquitecto", hints: ["Planos", "Edificio", "Dise√±o"] },
            { word: "Periodista", hints: ["Noticias", "Entrevista", "Reportaje"] },
            { word: "Mec√°nico", hints: ["Motor", "Taller", "Aceite"] },
            { word: "Piloto", hints: ["Avi√≥n", "Cielo", "Cabina"] },
            { word: "Bailar√≠n", hints: ["M√∫sica", "Escenario", "Coreograf√≠a"] },
            { word: "Dise√±ador", hints: ["Creativo", "Gr√°fico", "Moda"] }
        ]
    };

    let players = [];
    let currentPlayerIndex = 0;
    let currentWord = "";
    let currentCategory = "";
    let assignedRoles = []; 
    let isRevealed = false;
    let deadPlayers = [];
    let selectedWordData = null; // Almacena {word: "X", hints: ["A", "B", "C"]}

    // --- INICIALIZACI√ìN ---
    window.onload = () => {
        initCategorySelect();
        initCategoryTags();
        handleSetupChange(); 
    };

    function initCategorySelect() {
        const select = document.getElementById('category-select');
        select.innerHTML = ''; 
        
        // Funci√≥n para contar palabras en la nueva estructura
        const countWords = (cat) => database[cat] ? database[cat].length : 0;

        let optRand = document.createElement('option');
        optRand.value = "random_all";
        optRand.innerText = "üé≤ Aleatorio (Todo)";
        select.appendChild(optRand);

        let optMix = document.createElement('option');
        optMix.value = "random_mix";
        optMix.innerText = "‚öôÔ∏è Mezcla (Elegir cu√°les...)";
        optMix.style.fontWeight = "bold";
        optMix.style.color = "#bb86fc";
        select.appendChild(optMix);

        let optCust = document.createElement('option');
        optCust.value = "custom";
        optCust.innerText = "‚úçÔ∏è Crear Propia Lista";
        select.appendChild(optCust);

        for (let cat in database) {
            let opt = document.createElement('option');
            opt.value = cat;
            opt.innerText = `${cat} (${countWords(cat)})`;
            select.appendChild(opt);
        }
    }

    function initCategoryTags() {
        const container = document.getElementById('tags-container');
        container.innerHTML = '';
        for (let cat in database) {
            const tag = document.createElement('div');
            tag.className = 'cat-tag active'; 
            tag.innerText = cat;
            tag.dataset.cat = cat;
            tag.onclick = function() {
                this.classList.toggle('active');
            };
            container.appendChild(tag);
        }
    }
    
    // Maneja la visibilidad de los campos condicionales
    function handleSetupChange() {
        // L√≥gica de Categor√≠a
        const catVal = document.getElementById('category-select').value;
        const customArea = document.getElementById('custom-area');
        const filterArea = document.getElementById('category-filter-area');

        if (catVal === 'custom') customArea.classList.remove('hidden');
        else customArea.classList.add('hidden');

        if (catVal === 'random_mix') filterArea.classList.remove('hidden');
        else filterArea.classList.add('hidden');

        // L√≥gica de Impostores
        const impostorVal = document.getElementById('impostor-count-select').value;
        const impostorCustomGroup = document.getElementById('impostor-custom-input-group');
        
        if (impostorVal === 'custom') impostorCustomGroup.classList.remove('hidden');
        else impostorCustomGroup.classList.add('hidden');
    }


    // --- JUGADORES ---
    function addPlayer() {
        const input = document.getElementById('player-name-input');
        const name = input.value.trim();
        if (name && !players.includes(name)) {
            players.push(name);
            renderPlayerList();
            input.value = '';
        } else if (players.includes(name)) alert("Nombre repetido.");
    }

    function removePlayer(name) {
        players = players.filter(p => p !== name);
        renderPlayerList();
    }

    function renderPlayerList() {
        const list = document.getElementById('player-list-display');
        list.innerHTML = '';
        players.forEach(p => {
            const li = document.createElement('li');
            li.innerHTML = `<span>${p}</span> <span class="remove-player" onclick="removePlayer('${p}')">√ó</span>`;
            list.appendChild(li);
        });
    }

    function handleEnter(e) { if (e.key === 'Enter') addPlayer(); }

    // --- GAME LOGIC ---
    function startGame() {
        
        // 1. VALIDACI√ìN y C√ÅLCULO DE IMPOSTORES
        if (players.length < 3) return alert("M√≠nimo 3 jugadores.");
        
        const impostorSelect = document.getElementById('impostor-count-select').value;
        let impostorCount;

        if (impostorSelect === 'random') {
            const min = 1;
            const max = players.length - 1; 
            impostorCount = Math.floor(Math.random() * (max - min + 1)) + min;
            
        } else if (impostorSelect === 'custom') {
            impostorCount = parseInt(document.getElementById('custom-impostor-count').value);
            if (isNaN(impostorCount) || impostorCount < 1) return alert("Por favor, introduce un n√∫mero v√°lido para los impostores.");
            
        } else {
            impostorCount = parseInt(impostorSelect);
        }

        if (impostorCount >= players.length) return alert(`Demasiados impostores (${impostorCount}). Debe haber al menos un civil. M√°ximo permitido: ${players.length - 1}.`);
        
        // 2. SELECCI√ìN DE PALABRA Y CATEGOR√çA
        const catSelect = document.getElementById('category-select').value;
        let sourceCategoryWords = []; // Lista de objetos {word, hints}

        if (catSelect === 'custom') {
            const raw = document.getElementById('custom-words-input').value;
            const rawWords = raw.split(',').map(w => w.trim()).filter(w => w.length > 0);
            if (rawWords.length < 2) return alert("Escribe al menos 2 palabras.");
            currentCategory = "Personalizado";
            // Para la opci√≥n personalizada, se crea una estructura simple
            sourceCategoryWords = rawWords.map(w => ({ word: w, hints: [] })); 
        } 
        else if (catSelect === 'random_all') {
            const keys = Object.keys(database);
            const randKey = keys[Math.floor(Math.random() * keys.length)];
            sourceCategoryWords = database[randKey];
            currentCategory = randKey;
        } 
        else if (catSelect === 'random_mix') {
            const tags = document.querySelectorAll('.cat-tag.active');
            if (tags.length === 0) return alert("¬°Selecciona al menos una categor√≠a en los filtros!");
            
            const selectedCats = Array.from(tags).map(t => t.dataset.cat);
            const randKey = selectedCats[Math.floor(Math.random() * selectedCats.length)];
            sourceCategoryWords = database[randKey];
            currentCategory = randKey;
        } 
        else {
            sourceCategoryWords = database[catSelect];
            currentCategory = catSelect;
        }

        if (sourceCategoryWords.length === 0) return alert("La categor√≠a seleccionada no tiene palabras.");

        // Seleccionar una palabra/pista aleatoria
        selectedWordData = sourceCategoryWords[Math.floor(Math.random() * sourceCategoryWords.length)];
        currentWord = selectedWordData.word;
        deadPlayers = [];

        // 3. C√ÅLCULO DE PISTA PARA EL IMPOSTOR
        const hintMode = document.getElementById('hint-mode-select').value;
        let impostorDisplayWord = `Pista: Algo de ${currentCategory}`;
        
        if (hintMode === 'enabled' && selectedWordData.hints && selectedWordData.hints.length > 0) {
            // Elegir una de las 3 pistas al azar
            const randHintIndex = Math.floor(Math.random() * selectedWordData.hints.length);
            impostorDisplayWord = `Pista: ${selectedWordData.hints[randHintIndex]}`;
        }
        // Nota: Si es "Personalizado" y tiene pistas, solo muestra la categor√≠a (como indica el texto)

        // 4. ASIGNAR ROLES
        let roles = Array(players.length).fill('civilian');
        let indices = players.map((_, i) => i);
        
        for (let i = indices.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [indices[i], indices[j]] = [indices[j], indices[i]];
        }
        
        for(let i=0; i<impostorCount; i++) roles[indices[i]] = 'impostor';

        assignedRoles = players.map((name, i) => {
            return {
                name: name,
                role: roles[i],
                // El impostor recibe la pista calculada, el civil la palabra real
                displayWord: roles[i] === 'civilian' ? currentWord : impostorDisplayWord
            };
        });

        // 5. INICIO
        currentPlayerIndex = 0;
        switchScreen('screen-reveal');
        updateRevealScreen();
    }

    // --- REVELACI√ìN ---
    function updateRevealScreen() {
        if (currentPlayerIndex >= players.length) {
            switchScreen('screen-game');
            return;
        }
        const player = assignedRoles[currentPlayerIndex];
        document.getElementById('turn-player-name').innerText = `Turno de: ${player.name}`;
        
        const card = document.getElementById('card-container');
        card.classList.remove('revealed');
        isRevealed = false;
        
        const btn = document.getElementById('next-player-btn');
        btn.disabled = true;
        btn.classList.replace('btn-primary', 'btn-secondary');

        const secretDiv = document.getElementById('secret-text');
        if (player.role === 'impostor') {
            // El impostor siempre ve "¬°ERES EL IMPOSTOR!", y la pista abajo.
            secretDiv.innerHTML = `<span class="impostor-text">¬°ERES EL IMPOSTOR!</span><br><span style="font-size:0.8rem; color:#aaa; font-weight:normal">${player.displayWord}</span>`;
        } else {
            // El civil solo ve la palabra real.
            secretDiv.innerHTML = `<span>${player.displayWord}</span>`;
        }
    }

    function toggleSecret() {
        const card = document.getElementById('card-container');
        const btn = document.getElementById('next-player-btn');
        if (!isRevealed) {
            card.classList.add('revealed');
            isRevealed = true;
            btn.disabled = false;
            btn.classList.replace('btn-secondary', 'btn-primary');
        } else {
            card.classList.remove('revealed');
            isRevealed = false;
        }
    }
    
    function nextPlayer() {
        if (document.getElementById('card-container').classList.contains('revealed')) 
            document.getElementById('card-container').classList.remove('revealed');
        currentPlayerIndex++;
        updateRevealScreen();
    }

    // --- VOTACI√ìN ---
    function goToVoting() {
        const grid = document.getElementById('voting-grid');
        grid.innerHTML = '';
        assignedRoles.forEach(p => {
            if(!deadPlayers.includes(p.name)) {
                const btn = document.createElement('button');
                btn.className = 'vote-btn';
                btn.innerText = p.name;
                btn.onclick = () => confirmVote(p);
                grid.appendChild(btn);
            }
        });
        switchScreen('screen-voting');
    }

    function confirmVote(p) {
        if(confirm(`¬øExpulsar a ${p.name}?`)) {
            deadPlayers.push(p.name);
            const rSpan = document.getElementById('ejected-role');
            document.getElementById('ejected-name').innerText = p.name;
            if(p.role === 'impostor') {
                rSpan.innerText = "¬°UN IMPOSTOR!";
                rSpan.className = "ejection-role is-impostor";
            } else {
                rSpan.innerText = "UN CIVIL INOCENTE...";
                rSpan.className = "ejection-role is-civilian";
            }
            switchScreen('screen-ejection');
        }
    }

    function continueGame() {
        if((players.length - deadPlayers.length) < 2) {
            alert("Queda un solo jugador. El juego ha terminado.");
            endGame();
        } else switchScreen('screen-game');
    }

    // --- FIN ---
    function endGame() {
        switchScreen('screen-results');
        document.getElementById('reveal-word').innerText = currentWord;
        const list = document.getElementById('results-list');
        list.innerHTML = '';
        assignedRoles.forEach(p => {
            const div = document.createElement('div');
            div.className = 'result-item';
            let status = deadPlayers.includes(p.name) ? " (Expulsado)" : "";
            let roleTxt = p.role === 'impostor' ? 'IMPOSTOR' : 'Civil';
            let roleCls = p.role === 'impostor' ? 'is-impostor' : 'is-civilian';
            div.innerHTML = `<span class="${deadPlayers.includes(p.name)?'is-dead':''}">${p.name}${status}</span><span class="role-highlight ${roleCls}">${roleTxt}</span>`;
            list.appendChild(div);
        });
    }

    function resetGame() { switchScreen('screen-setup'); }
    function switchScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
</script>
</body>
</html>
