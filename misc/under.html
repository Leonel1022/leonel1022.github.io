<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laberinto Mettaton</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');

        :root { --tile-size: 40px; }

        body {
            background-color: #000; color: #fff; font-family: 'VT323', monospace;
            display: flex; flex-direction: column; align-items: center; margin: 0; padding: 10px;
            user-select: none; touch-action: manipulation;
        }

        /* Panel de Estado */
        #status-panel {
            border: 2px solid #fff; width: 90%; max-width: 520px; padding: 10px; margin-bottom: 10px;
            display: flex; flex-direction: column; align-items: center; background: #000;
        }

        #jump-container { width: 100%; height: 20px; border: 2px solid #fff; margin-top: 5px; position: relative; background: #222; }
        #jump-bar { height: 100%; width: 0%; background: #00ffff; transition: width 0.3s; }
        #jump-text { position: absolute; width: 100%; text-align: center; top: 0; font-size: 1rem; color: #fff; text-shadow: 1px 1px #000; }

        /* El Puzzle */
        #game-wrapper { position: relative; border: 4px solid #fff; background-color: #000; margin-bottom: 10px; }
        #grid { display: grid; grid-template-columns: repeat(12, var(--tile-size)); grid-template-rows: repeat(6, var(--tile-size)); }

        .tile { width: var(--tile-size); height: var(--tile-size); box-sizing: border-box; border: 1px solid rgba(255, 255, 255, 0.05); }
        .pink { background-color: #ff69b4; }
        .green { background-color: #00ff00; }
        .red { background-color: #ff0000; }
        .yellow { background-color: #ffff00; }
        .orange { background-color: #ffa500; }
        .purple { background-color: #800080; }
        .blue { background-color: #0000ff; }
        .finish-line { border: 3px double white; box-shadow: inset 0 0 10px white; }

        /* Jugador */
        #player {
            position: absolute; width: 26px; height: 26px; z-index: 10;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="red"><path d="M50 85 C10 55 0 35 0 20 C0 5 15 -5 35 5 C45 10 50 20 50 20 C50 20 55 10 65 5 C85 -5 100 5 100 20 C100 35 90 55 50 85 Z" stroke="white" stroke-width="5"/></svg>');
            background-size: contain; background-repeat: no-repeat; transition: all 0.1s;
        }

        .insulated { filter: drop-shadow(0 0 5px #ffa500) contrast(1.2); }
        .jump-ready { filter: drop-shadow(0 0 8px #00ffff); transform: scale(1.15); }

        #msg-log { color: #ffff00; height: 30px; font-weight: bold; margin: 5px 0; font-size: 1.4rem; text-align: center;}

        /* Controles */
        #controls-layout { display: flex; flex-direction: column; align-items: center; gap: 15px; }
        
        #controls { 
            display: grid; 
            grid-template-areas: 
                ". up . ."
                "left . right jump"
                ". down . ."; 
            gap: 12px; 
        }

        .ctrl-btn {
            width: 55px; height: 50px; background: #000; border: 2px solid #fff; color: #fff;
            font-family: 'VT323', monospace; font-size: 1.5rem; display: flex; justify-content: center; align-items: center; cursor: pointer;
        }
        .ctrl-btn:active { background: #fff; color: #000; }
        
        .up { grid-area: up; } .down { grid-area: down; } 
        .left { grid-area: left; } .right { grid-area: right; }
        
        .jump-btn { grid-area: jump; background: #003333; font-size: 0.9rem; width: 70px; }
        .jump-btn.ready { background: #00ffff; color: #000; animation: blink 1s infinite; }

        .regen-btn {
            width: 220px; height: 45px; background: #000; border: 2px solid #fff; color: #fff;
            font-family: 'VT323', monospace; font-size: 1.4rem; cursor: pointer; letter-spacing: 2px;
        }
        .regen-btn:hover { background: #fff; color: #000; }

        @keyframes blink { 50% { opacity: 0.5; } }

        /* Reglas */
        #rules-summary { max-width: 500px; font-size: 1rem; border-top: 2px solid #fff; padding: 10px; margin-top: 20px;}
        .rule-row { display: flex; align-items: center; margin-bottom: 4px; }
        .color-box { width: 14px; height: 14px; margin-right: 10px; border: 1px solid #fff; }

        @media (max-width: 550px) { 
            :root { --tile-size: 30px; }
            .ctrl-btn { width: 45px; height: 40px; }
            .jump-btn { width: 60px; }
        }
    </style>
</head>
<body>

    <h1>Puzzle de Mettaton</h1>

    <div id="status-panel">
        <div id="msg-log">¡Esquiva los muros rojos!</div>
        <div style="font-size: 1.3rem;">AISLANTE: <span id="stat-insulated">DESACTIVADO</span></div>
        <div id="jump-container">
            <div id="jump-bar"></div>
            <div id="jump-text">SALTO: 0%</div>
        </div>
    </div>

    <div id="game-wrapper">
        <div id="player"></div>
        <div id="grid"></div>
    </div>

    <div id="controls-layout">
        <div id="controls">
            <div class="ctrl-btn up" onclick="handleInput('ArrowUp')">▲</div>
            <div class="ctrl-btn left" onclick="handleInput('ArrowLeft')">◀</div>
            <div class="ctrl-btn down" onclick="handleInput('ArrowDown')">▼</div>
            <div class="ctrl-btn right" onclick="handleInput('ArrowRight')">▶</div>
            <div id="jump-btn-ui" class="ctrl-btn jump-btn" onclick="toggleJump()">SALTAR</div>
        </div>

        <button class="regen-btn" onclick="generateGrid()">REGENERAR MAPA</button>
    </div>

    <div id="rules-summary">
        <div class="rule-row"><div class="color-box red"></div><span><b>Rojo:</b> Muro infranqueable (Salta con SALTAR).</span></div>
        <div class="rule-row"><div class="color-box orange"></div><span><b>Naranja:</b> Te da AISLANTE contra baldosas amarillas.</span></div>
        <div class="rule-row"><div class="color-box blue"></div><span><b>Azul:</b> Agua. Si hay un amarillo cerca, mueres igual.</span></div>
        <div class="rule-row"><div class="color-box green"></div><span><b>Verde:</b> 1 segundo para salir o el mapa cambia.</span></div>
        <div class="rule-row"><div class="color-box pink"></div><span><b>Rosa:</b> No hace nada,puedes pasear por el con tranquilidad.</span></div>
        <div class="rule-row"><div class="color-box purple"></div><span><b>Violeta:</b> Te resbalaras hasta el proximo espacio.</span></div>
        <div class="rule-row"><div class="color-box yellow"></div><span><b>Amarillo:</b> Te electrocutaras si no tienes aislamiento.</span></div>
    </div>

<script>
    const ROWS = 6; const COLS = 12;
    // Ajustado para que el mapa sea un poco más difícil
    const COLORS = ['pink', 'pink', 'green', 'red', 'red', 'yellow', 'orange', 'purple', 'blue', 'blue'];
    
    let grid = [];
    let player = { x: 0, y: 0 };
    let lastStablePos = { x: 0, y: 0 };
    let isInsulated = false;
    let jumpCharge = 0; 
    let jumpActive = false;
    let isLocked = false;
    let greenTimer = null;

    const playerEl = document.getElementById('player');
    const gridEl = document.getElementById('grid');
    const msgLog = document.getElementById('msg-log');
    const jumpBar = document.getElementById('jump-bar');
    const jumpText = document.getElementById('jump-text');
    const jumpBtnUi = document.getElementById('jump-btn-ui');

    generateGrid();

    window.addEventListener('keydown', (e) => {
        if(e.code === 'Space') toggleJump();
        else handleInput(e.key);
    });

    function generateGrid() {
        gridEl.innerHTML = ''; grid = []; isInsulated = false; jumpCharge = 0; jumpActive = false;
        clearTimeout(greenTimer);
        msgLog.innerText = "* Mapa regenerado.";

        for (let y = 0; y < ROWS; y++) {
            let row = [];
            for (let x = 0; x < COLS; x++) {
                let color;
                if (x === COLS - 1 || (x === 0 && y === 0)) color = 'pink';
                else color = COLORS[Math.floor(Math.random() * COLORS.length)];
                
                const tile = document.createElement('div');
                tile.className = `tile ${color}`;
                if (x === COLS - 1) tile.classList.add('finish-line');
                gridEl.appendChild(tile);
                row.push(color);
            }
            grid.push(row);
        }
        player = { x: 0, y: 0 }; lastStablePos = { x: 0, y: 0 };
        updateUI(); updatePlayerPos();
    }

    function toggleJump() {
        if (jumpCharge >= 100) {
            jumpActive = !jumpActive;
            msgLog.innerText = jumpActive ? "* ¡Listo para saltar!" : "* Salto cancelado.";
            updateUI();
        } else {
            msgLog.innerText = "* No hay suficiente energía.";
        }
    }

    function handleInput(key) {
        if (isLocked) return;
        let dx = 0, dy = 0;
        const k = key.toLowerCase();
        if (key === 'ArrowUp' || k === 'w') dy = -1;
        else if (key === 'ArrowDown' || k === 's') dy = 1;
        else if (key === 'ArrowLeft' || k === 'a') dx = -1;
        else if (key === 'ArrowRight' || k === 'd') dx = 1;
        else return;
        attemptMove(dx, dy);
    }

    function attemptMove(dx, dy) {
        let stepSize = jumpActive ? 2 : 1;
        const newX = player.x + (dx * stepSize);
        const newY = player.y + (dy * stepSize);

        if (newX < 0 || newX >= COLS || newY < 0 || newY >= ROWS) return;

        if (!jumpActive && grid[newY][newX] === 'red') {
            msgLog.innerText = "* El muro rojo te bloquea.";
            return;
        }

        if (jumpActive) {
            jumpCharge = 0; jumpActive = false;
            msgLog.innerText = "* ¡BOING!";
        } else {
            // Carga de 20 pasos (5% cada uno)
            jumpCharge = Math.min(100, jumpCharge + 5);
        }

        clearTimeout(greenTimer);
        lastStablePos = { ...player };
        player.x = newX;
        player.y = newY;
        updatePlayerPos();
        updateUI();

        setTimeout(() => processTileEffect(grid[newY][newX], dx, dy), 50);
    }

    function processTileEffect(color, lastDx, lastDy) {
        if (color === 'orange') {
            isInsulated = true;
            msgLog.innerText = "* Tienes AISLANTE eléctrico.";
            updateUI();
        }

        if (color === 'yellow' && !isInsulated) {
            triggerShock("¡BZZZT! ¡Necesitas aislante!");
            return;
        }

        if (color === 'blue') {
            let dangerous = false;
            [[0,1],[0,-1],[1,0],[-1,0]].forEach(([nx, ny]) => {
                let tx = player.x + nx, ty = player.y + ny;
                if (tx >= 0 && tx < COLS && ty >= 0 && ty < ROWS && grid[ty][tx] === 'yellow') dangerous = true;
            });
            if (dangerous) {
                triggerShock("¡Agua electrificada! El aislante falló.");
                return;
            }
        }

        if (color === 'green') {
            msgLog.innerText = "¡ALARMA! ¡SAL DE AHÍ!";
            greenTimer = setTimeout(() => { alert("¡EL MONSTRUO TE REUBICÓ!"); generateGrid(); }, 1000);
        }

        if (color === 'purple') {
            isLocked = true;
            setTimeout(() => { isLocked = false; attemptMove(lastDx, lastDy); }, 180);
        }

        if (player.x === COLS - 1) {
            msgLog.innerText = "¡LO LOGRASTE!";
            setTimeout(() => { alert("¡Victoria!"); generateGrid(); }, 300);
        }
    }

    function triggerShock(msg) {
        isLocked = true; msgLog.innerText = msg;
        playerEl.style.filter = "invert(1) brightness(2) sepia(1)";
        setTimeout(() => {
            player = { ...lastStablePos };
            playerEl.style.filter = "none";
            updatePlayerPos(); isLocked = false;
            updateUI();
        }, 500);
    }

    function updatePlayerPos() {
        const tileSize = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--tile-size'));
        playerEl.style.left = (player.x * tileSize + (tileSize-26)/2) + 'px';
        playerEl.style.top = (player.y * tileSize + (tileSize-26)/2) + 'px';
    }

    function updateUI() {
        const insEl = document.getElementById('stat-insulated');
        insEl.innerText = isInsulated ? "ACTIVADO" : "DESACTIVADO";
        insEl.style.color = isInsulated ? "#ffa500" : "#fff";
        
        playerEl.className = isInsulated ? "insulated" : "";
        if(jumpActive) playerEl.classList.add('jump-ready');

        jumpBar.style.width = jumpCharge + "%";
        jumpText.innerText = `SALTO: ${jumpCharge}%`;
        
        if(jumpCharge >= 100) jumpBtnUi.classList.add('ready');
        else { jumpBtnUi.classList.remove('ready'); jumpActive = false; }
        
        jumpBtnUi.style.boxShadow = jumpActive ? "0 0 15px #00ffff" : "none";
    }
</script>
</body>
</html>
